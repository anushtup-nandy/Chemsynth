propose_new_route:
  prompt: |
    You are an expert computational chemist and AI assistant. Your task is to propose a new, hypothetical chemical synthesis route based on a user's suggestion.

    **Target Molecule SMILES:**
    {target_molecule_smiles}

    **User's Suggestion:**
    "{user_suggestion}"

    **Context (Existing AI-Generated Routes):**
    ```json
    {existing_routes_json}
    ```

    **Instructions:**
    1.  Analyze the user's suggestion in the context of the existing routes.
    2.  Construct a new, plausible synthesis route that incorporates the user's idea. The route should be chemically reasonable, even if speculative.
    3.  The new route must have at least one step.
    4.  Estimate a plausible `overall_yield` (as a float between 0.0 and 1.0) and per-step `yield` (as a float between 0.0 and 100.0).
    5.  Provide brief, insightful `advantages` and `challenges` for your proposed route.
    6.  **Your final output MUST be a single, valid JSON object that strictly follows the structure of the provided existing routes.** Do not include any text, explanations, or code block markers outside of the JSON object.

    **JSON Output Structure:**
    {
      "id": "route_hypothetical_0",
      "name": "User-Suggested Route",
      "overall_yield": 0.55,
      "steps": [
        {
          "step_number": 1,
          "title": "Your Invented Reaction Title",
          "yield": 75.0,
          "reagents_conditions": "Reagents, solvents, conditions...",
          "source_notes": "Based on user's suggestion to use [reaction type]. This is a hypothetical step.",
          "product": {"smiles": "...", "formula": "..."},
          "reactants": [{"smiles": "...", "formula": "..."}]
        }
      ],
      "evaluation": {
        "advantages": ["Advantage 1...", "Advantage 2..."],
        "challenges": ["Challenge 1...", "Challenge 2..."]
      }
    }

propose_chemfm_route:
  prompt: |
    You are an expert computational chemist and AI assistant. Your task is to take a retrosynthesis prediction from a specialized model (ChemFM) and format it into a complete, user-friendly synthesis route.

    **Context:**
    - **Target Molecule SMILES:** {target_molecule_smiles}
    - **Target Molecular Properties:** {target_molecule_properties}
    - **User's Suggestion/Constraint:** "{user_suggestion}"
    - **ChemFM Predicted Reactants (SMILES):** {chemfm_predicted_reactants}

    **Instructions:**
    1.  **Analyze the context.** You are given a target molecule and the starting materials predicted by ChemFM to synthesize it in a single step.
    2.  **Create a plausible reaction title and conditions.** Based on the transformation (reactants -> product) and the user's suggestion, invent a suitable reaction name (e.g., "Suzuki Coupling", "Reductive Amination") and propose realistic `reagents_conditions`.
    3.  **Calculate Formulas:** For each reactant SMILES and the product SMILES, calculate the molecular formula.
    4.  **Estimate Yields:** Propose a plausible `yield` for this single step (as a float between 0.0 and 100.0) and set the `overall_yield` to the same value (as a float between 0.0 and 1.0).
    5.  **Evaluate the Route:** Provide brief, insightful `advantages` and `challenges`. Consider the molecular properties and the nature of the reaction.
    6.  **Adhere to the JSON structure.** Your final output MUST be a single, valid JSON object that strictly follows the provided structure. Do not include any text, explanations, or code block markers outside of the JSON object.

    **JSON Output Structure:**
    {{
      "id": "route_chemfm_0",
      "name": "ChemFM Suggested Route",
      "overall_yield": 0.65,
      "steps": [
        {{
          "step_number": 1,
          "title": "Your Invented Reaction Title",
          "yield": 65.0,
          "reagents_conditions": "Reagents, solvents, and conditions based on the transformation and user suggestion.",
          "source_notes": "Route generated by ChemFM, guided by user suggestion. Conditions are hypothetical.",
          "product": {{"smiles": "{target_molecule_smiles}", "formula": "..."}},
          "reactants": [
            {{"smiles": "...", "formula": "..."}},
            {{"smiles": "...", "formula": "..."}}
          ]
        }}
      ],
      "evaluation": {{
        "advantages": ["Advantage 1: e.g., Uses readily available starting materials.", "Advantage 2: e.g., High-yielding reaction type."],
        "challenges": ["Challenge 1: e.g., May require specific catalyst.", "Challenge 2: e.g., Potential for side-products."]
      }}
    }}