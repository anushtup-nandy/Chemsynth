<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChemSynthAI | Digital Support System for Chemical Synthesis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.23.0/cytoscape.min.js"></script>
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://unpkg.com/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navigation -->
    <nav class="bg-gray-900 border-b border-gray-800 fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <div class="w-10 h-10 rounded-full gradient-bg-blue flex items-center justify-center">
                            <i class="fas fa-atom text-white text-xl"></i>
                        </div>
                        <span class="ml-3 text-xl font-bold gradient-text-blue">ChemSynthAI</span>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="#" class="nav-link active px-3 py-2 rounded-md text-sm font-medium text-white">Dashboard</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white">Literature</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white">Synthesis</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white">Sourcing</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white">Cost Analysis</a>
                            <a href="#" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:text-white">Knowledge Base</a>
                        </div>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-4 flex items-center md:ml-6 space-x-3">
                        <!-- Theme Toggle Button -->
                        <button id="theme-toggle" class="theme-toggle" title="Toggle theme">
                            <i id="theme-icon" class="fas fa-sun"></i>
                        </button>
                        <button class="p-1 rounded-full text-gray-400 hover:text-white focus:outline-none relative">
                            <i class="fas fa-bell"></i>
                            <span class="absolute top-0 right-0 h-2 w-2 rounded-full bg-red-500"></span>
                        </button>
                        <div class="ml-3 relative">
                            <div>
                                <button class="max-w-xs flex items-center text-sm rounded-full focus:outline-none">
                                    <img class="h-8 w-8 rounded-full" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <!-- Mobile Theme Toggle -->
                    <button id="theme-toggle-mobile" class="theme-toggle mr-2" title="Toggle theme">
                        <i id="theme-icon-mobile" class="fas fa-sun"></i>
                    </button>
                    <button class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-20 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        <!-- Project Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
            <div>
                <h1 class="text-2xl font-bold mb-2">Synthesis Project: <span id="project-target-molecule-formula" class="gradient-text-blue">C20H25NO3</span></h1>
                <p id="project-target-molecule-name" class="text-gray-400">Enter a target molecule to begin...</p>
            </div>
            <div class="mt-4 md:mt-0 flex space-x-3">
                <button id="save-project-btn" class="bg-gray-800 text-gray-300 hover:bg-gray-700 font-medium py-2 px-4 rounded-lg border border-gray-700"><i class="fas fa-save mr-2"></i> Save Project</button>
                <button id="open-project-btn" class="gradient-bg-blue text-white font-medium py-2 px-4 rounded-lg hover:shadow-lg"><i class="fas fa-folder-open mr-2"></i> Open Project</button>
                <input type="file" id="project-file-input" class="hidden" accept=".json">
            </div>
        </div>
        
        <!-- Progress Tracker -->
        <div class="bg-gray-800 rounded-xl p-6 mb-8">
            <h2 class="text-lg font-bold mb-4">Project Progress</h2>
            <div class="progress-bar mb-2">
                <div id="project-progress-bar" class="progress-fill" style="width: 0%"></div>
            </div>
            <div id="project-progress-steps" class="flex justify-between text-sm text-gray-400">
                <!-- Progress steps will be dynamically updated here -->
            </div>
        </div>
        
        <!-- Main Content Tabs -->
        <div class="border-b border-gray-700 mb-6">
            <nav id="main-tabs" class="-mb-px flex space-x-8">
                <a href="#" data-tab="literature" class="tab-link border-blue-500 text-blue-500 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"><i class="fas fa-book-open mr-2"></i> Literature Analysis</a>
                <a href="#" data-tab="synthesis" class="tab-link border-transparent text-gray-500 hover:text-gray-300 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"><i class="fas fa-project-diagram mr-2"></i> Synthesis Design</a>
                <a href="#" data-tab="sourcing" class="tab-link border-transparent text-gray-500 hover:text-gray-300 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"><i class="fas fa-boxes mr-2"></i> Material Sourcing</a>
                <a href="#" data-tab="cost" class="tab-link border-transparent text-gray-500 hover:text-gray-300 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"><i class="fas fa-calculator mr-2"></i> Cost Analysis</a>
                <a href="#" data-tab="knowledge" class="tab-link border-transparent text-gray-500 hover:text-gray-300 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"><i class="fas fa-brain mr-2"></i> Knowledge Graph</a>
            </nav>
        </div>
        
        <!-- Literature Analysis Section -->
        <div id="literature-content" class="tab-content grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Search Panel -->
            <div class="lg:col-span-1 bg-gray-800 rounded-xl p-6">
                <h3 class="text-lg font-bold mb-4">Literature Search</h3>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-300 mb-1">Target Molecule or Keyword</label>
                    <input type="text" id="target-molecule-input" class="molecule-input w-full p-3 rounded-lg" placeholder="Enter SMILES, Name, or CAS">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-300 mb-1">Search Terms (Optional)</label>
                    <input type="text" id="search-terms-input" class="molecule-input w-full p-3 rounded-lg" placeholder="e.g., synthesis, acylation, ketone formation">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-300 mb-1">Filters</label>
                    <div class="space-y-2 mt-2">
                        <div class="flex items-center"><input id="high-impact" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-600 rounded"><label for="high-impact" class="ml-2 block text-sm text-gray-300">High Impact Journals</label></div>
                        <div class="flex items-center"><input id="reviewed" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-600 rounded" checked><label for="reviewed" class="ml-2 block text-sm text-gray-300">Peer Reviewed Only</label></div>
                        <div class="flex items-center"><input id="patents" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-600 rounded"><label for="patents" class="ml-2 block text-sm text-gray-300">Include Patents</label></div>
                    </div>
                </div>
                <button id="literature-search-btn" class="gradient-bg-blue text-white font-medium py-3 px-6 rounded-lg w-full hover:shadow-lg"><i class="fas fa-search mr-2"></i> Search Literature</button>
            </div>
            
            <!-- Results Panel -->
            <div class="lg:col-span-2 bg-gray-800 rounded-xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 id="literature-results-count" class="text-lg font-bold">Literature Results</h3>
                    <div class="flex items-center">
                        <span class="text-sm text-gray-400 mr-3">Sort by:</span>
                        <select id="literature-sort-select" class="bg-gray-700 text-gray-300 text-sm p-2 rounded-lg">
                            <option value="relevance">Relevance</option>
                            <option value="citations">Citation Count</option>
                            <option value="date">Publication Date</option>
                        </select>
                    </div>
                </div>
                
                <!-- Dynamic results will be injected here -->
                <div id="literature-results-container">
                    <p class="text-gray-500 text-center">Enter search terms and click "Search Literature" to see results.</p>
                </div>
                
                <div class="text-center mt-6">
                    <button class="border border-gray-600 text-gray-300 hover:border-blue-500 hover:text-blue-500 font-medium py-2 px-6 rounded-lg transition-all">Load More Results</button>
                </div>
            </div>
        </div>
        
        <!-- Synthesis Route Section -->
        <div id="synthesis-content" class="tab-content bg-gray-800 rounded-xl p-6 mb-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">Proposed Synthesis Routes</h2>
                <button id="new-route-btn" class="gradient-bg-blue text-white font-medium py-2 px-4 rounded-lg">
                    <i class="fas fa-plus mr-2"></i> New Route
                </button>
            </div>
            
            <!-- Route Tabs will be injected here -->
            <div id="synthesis-route-tabs-container" class="border-b border-gray-700 mb-6">
                <!-- e.g., <nav class="-mb-px flex space-x-8"> ... </nav> -->
            </div>
            
            <!-- Container for the currently displayed route's content -->
            <div id="synthesis-route-content-container">
                <!-- This will be populated by JS with visualization, details, and evaluation -->
            </div>
        </div>
        
        <!-- Material Sourcing Section -->
        <div id="sourcing-content" class="tab-content bg-gray-800 rounded-xl p-6 mb-8 hidden">
             <!-- This will be populated by JS -->
             <p class="text-center text-gray-500 py-16">Perform a synthesis plan search to see material sourcing information.</p>
        </div>
        
        <!-- Cost Analysis Section -->
        <div id="cost-content" class="tab-content bg-gray-800 rounded-xl p-6 mb-8 hidden">
             <!-- This will be populated by JS -->
             <p class="text-center text-gray-500 py-16">Perform a synthesis plan search to see cost analysis.</p>
        </div>
        
        <!-- Knowledge Graph Section -->
        <div id="knowledge-content" class="tab-content bg-gray-800 rounded-xl p-6 hidden">
             <!-- Container for the graph -->
             <h2 class="text-xl font-bold mb-4">Synthesis Knowledge Graph</h2>
             <p class="text-sm text-gray-400 mb-6">Visual representation of the selected synthesis route, from starting materials to the final product, including vendor relationships.</p>
             <div id="cy-knowledge-graph" class="w-full h-[600px] border border-gray-700 rounded-lg bg-gray-900">
                 <!-- Cytoscape.js will render the graph here -->
                 <p class="text-center text-gray-500 pt-16">Select a synthesis route to generate its knowledge graph.</p>
             </div>
        </div>
        
        <!-- CTA Section -->
        <div class="gradient-bg-blue rounded-xl p-8 md:p-12 text-center mt-12">
             <h2 class="text-2xl md:text-3xl font-bold mb-4">Ready to Optimize Your Chemical Synthesis?</h2>
             <p class="text-white text-opacity-90 mb-8 max-w-2xl mx-auto">ChemSynthAI combines AI-powered literature analysis, synthesis design, and material sourcing into one integrated platform to accelerate your research.</p>
             <div class="flex flex-col sm:flex-row justify-center gap-4"><button class="bg-white text-gray-900 font-bold py-3 px-8 rounded-full hover:bg-gray-100 transition-all">Request a Demo</button><button class="bg-transparent border-2 border-white text-white font-bold py-3 px-8 rounded-full hover:bg-white hover:bg-opacity-10 transition-all">Contact Our Team</button></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-800">
        <!-- Footer content remains the same -->
    </footer>
    
    <!-- New Route Modal -->
    <div id="new-route-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-lg border border-gray-700">
            <h3 class="text-lg font-bold mb-2 gradient-text-blue">Suggest an Alternative Route</h3>
            <p class="text-sm text-gray-400 mb-4">
                Guide the AI by suggesting a specific reaction type, a different starting material, or any other constraint.
            </p>
            
            <div>
                <label for="new-route-suggestion-input" class="block text-sm font-medium text-gray-300 mb-1">Your Suggestion:</label>
                <textarea id="new-route-suggestion-input" rows="4" class="molecule-input w-full p-3 rounded-lg" placeholder="e.g., 'Use a Heck reaction to form the C-C bond' or 'Start from commercially available aniline'"></textarea>
            </div>
            
            <div class="mt-6 flex justify-end space-x-4">
                <button id="cancel-new-route-btn" class="bg-gray-600 text-gray-200 hover:bg-gray-500 font-medium py-2 px-4 rounded-lg">Cancel</button>
                <button id="submit-new-route-btn" class="gradient-bg-blue text-white font-medium py-2 px-4 rounded-lg hover:shadow-lg">
                    <i class="fas fa-cogs mr-2"></i> Generate Route
                </button>
            </div>
        </div>
    </div>

    <!-- Bayesian Optimization Modal -->
    <div id="optimization-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-6xl h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b border-gray-700">
                <h3 class="text-lg font-bold text-white">Bayesian Reaction Optimization</h3>
                <button id="close-optimization-modal-btn" class="text-gray-400 hover:text-white">&times;</button>
            </div>

            <!-- STATE 1: SETUP (Visible by default when opened) -->
            <div id="optimization-setup-state" class="p-6 flex-grow overflow-y-auto">
                <h4 class="font-bold text-blue-400 mb-4">Step 1: Provide Prior Knowledge (Optional)</h4>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Column 1: Constraints -->
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <h5 class="font-semibold mb-3 text-gray-200">Constrain Search Space</h5>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-300 mb-1">Allowed Solvents (comma-separated)</label>
                                <input type="text" id="prior-solvents" class="molecule-input w-full" placeholder="e.g., C1CCOC1, CC(C)=O">
                            </div>
                            <!-- Reagents -->
                            <div>
                                <label class="block text-sm text-gray-300 mb-2">Reagents to Optimize</label>
                                <div id="prior-reagents-container" class="space-y-2">
                                    <!-- JS will populate this -->
                                </div>
                                <button id="add-prior-reagent-btn" class="text-xs text-blue-400 hover:text-blue-300 mt-2">
                                    <i class="fas fa-plus mr-1"></i> Add Reagent
                                </button>
                            </div>
                            <!-- Catalysts -->
                            <div>
                                <label class="block text-sm text-gray-300 mb-2">Catalysts to Optimize</label>
                                <div id="prior-catalysts-container" class="space-y-2">
                                    <!-- JS will populate this -->
                                </div>
                                <button id="add-prior-catalyst-btn" class="text-xs text-blue-400 hover:text-blue-300 mt-2">
                                    <i class="fas fa-plus mr-1"></i> Add Catalyst
                                </button>
</div>
                            <div>
                                <label class="block text-sm text-gray-300 mb-1">Temperature Range (Â°C)</label>
                                <div class="flex space-x-2">
                                    <input type="number" id="prior-temp-min" class="molecule-input w-full" placeholder="Min">
                                    <input type="number" id="prior-temp-max" class="molecule-input w-full" placeholder="Max">
                                </div>
                            </div>
                            <div id="dynamic-reactant-constraints-container" class="space-y-4">
                                <!-- JS will populate this section for reactions with >1 reactant -->
                            </div>
                        </div>
                    </div>
                    <!-- Column 2: Data Points -->
                    <div class="bg-gray-700 p-4 rounded-lg flex flex-col">
                        <h5 class="font-semibold mb-3 text-gray-200">Add Known Experimental Data Points</h5>
                        <div id="prior-data-points-container" class="space-y-2 flex-grow overflow-y-auto pr-2">
                            <!-- Data point rows will be injected here -->
                        </div>
                        <button id="add-data-point-btn" class="mt-4 text-sm bg-gray-600 hover:bg-gray-500 text-white font-medium py-2 px-4 rounded-lg w-full">
                            <i class="fas fa-plus mr-2"></i> Add Data Point
                        </button>
                    </div>
                </div>
                <div class="mt-6 text-center">
                    <button id="start-optimization-btn" class="gradient-bg-blue text-white font-bold py-3 px-12 rounded-lg hover:shadow-lg text-lg">
                        Start Optimization
                    </button>
                </div>
            </div>

            <!-- STATE 2: LOADING -->
            <div id="optimization-loading-state" class="hidden flex-grow flex items-center justify-center text-center p-6">
                <i class="fas fa-atom fa-spin text-blue-400 text-4xl"></i>
                <p class="mt-4 text-lg text-gray-300">Running Bayesian Optimization...</p>
                <!-- <p class="text-sm text-gray-500">This may take a minute. The system is exploring the reaction space to find the highest yield.</p> -->
            </div>

            <!-- STATE 3: RESULTS -->
            <div id="optimization-results-state" class="hidden flex-grow flex flex-col p-6 overflow-y-hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Chart -->
                        <div>
                            <h4 class="font-semibold mb-2 text-gray-200">Optimization Progress (Yield vs. Iteration)</h4>
                            <div class="bg-gray-900 p-2 rounded-lg">
                                <canvas id="optimization-chart"></canvas>
                            </div>
                        </div>
                        <!-- Summary -->
                        <div>
                            <h4 class="font-semibold mb-2 text-gray-200">Optimization Summary</h4>
                            <div id="optimization-summary-content" class="bg-gray-700 p-4 rounded-lg space-y-3">
                                <!-- Content will be injected by JS -->
                            </div>
                        </div>
                    </div>
                    <!-- History Table -->
                    <div class="mt-6">
                        <h4 class="font-semibold mb-2 text-gray-200">Full Optimization History</h4>
                        <div id="optimization-history-table" class="max-h-64 overflow-y-auto bg-gray-900 rounded-lg">
                            <!-- Table will be injected by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Theme Toggle Script -->
    <script>
        // Theme toggle functionality
        function initTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeToggleMobile = document.getElementById('theme-toggle-mobile');
            const themeIcon = document.getElementById('theme-icon');
            const themeIconMobile = document.getElementById('theme-icon-mobile');
            const html = document.documentElement;
            
            // Check for saved theme preference or default to 'dark'
            const currentTheme = localStorage.getItem('theme') || 'dark';
            html.setAttribute('data-theme', currentTheme);
            
            // Update icons based on current theme
            function updateIcons(theme) {
                const iconClass = theme === 'dark' ? 'fa-sun' : 'fa-moon';
                themeIcon.className = `fas ${iconClass}`;
                themeIconMobile.className = `fas ${iconClass}`;
            }
            
            updateIcons(currentTheme);
            
            // Toggle theme function
            function toggleTheme() {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateIcons(newTheme);
            }
            
            // Add event listeners
            themeToggle.addEventListener('click', toggleTheme);
            themeToggleMobile.addEventListener('click', toggleTheme);
        }
        
        // Initialize theme when DOM is loaded
        document.addEventListener('DOMContentLoaded', initTheme);
    </script>
    
    <!-- Link to external JavaScript file -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>